# Netplan VLAN Configuration - Generated by Ansible
# {{ ansible_managed }}

network:
  version: 2
  renderer: networkd

  vlans:
{% for vlan in network_vlans %}
{%   set prefix = vlan.prefix | default(24) %}
{%   set base   = vlan.gateway | regex_replace('\.\d+$', '') %}
{%   set hostip = vlan.address | default(base ~ '.10') %}
    {{ vlan.name }}:
      id: {{ vlan.id }}
      link: {{ ansible_default_ipv4.interface }}
      addresses:
        - {{ hostip }}/{{ prefix }}
      gateway4: {{ vlan.gateway }}
      nameservers:
        addresses:
          - 8.8.8.8
          - 1.1.1.1
{% endfor %}
