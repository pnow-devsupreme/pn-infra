# SSH Daemon Configuration - Generated by Ansible
# {{ ansible_managed }}

# Basic SSH settings
Port 22
Protocol 2

# Host Keys
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ed25519_key

# Authentication
PermitRootLogin {{ 'no' if security.ssh.root_login is defined and not security.ssh.root_login else 'no' }}
PubkeyAuthentication yes
PasswordAuthentication yes
PermitEmptyPasswords no

# User access
{% if users is defined %}
AllowUsers {{ users | map(attribute='username') | join(' ') }}
{% endif %}
AllowGroups sudo

# Connection settings
StrictModes yes
MaxAuthTries 3
LoginGraceTime {{ security.ssh.login_grace_time_secs | default(60) }}
MaxStartups {{ security.ssh.max_startups | default(10) }}

# Environment
PermitUserEnvironment {{ 'yes' if security.ssh.permit_user_environment | default(false) else 'no' }}
AcceptEnv LANG LC_*

# Network settings
TCPKeepAlive {{ 'yes' if security.ssh.tcp_keep_alive | default(true) else 'no' }}
Compression {{ 'yes' if security.ssh.compression | default(false) else 'no' }}

# Forwarding
AllowTcpForwarding {{ 'yes' if security.ssh.allow_tcp_forwarding | default(false) else 'no' }}
AllowStreamLocalForwarding {{ 'yes' if security.ssh.allow_stream_local_forwarding | default(false) else 'no' }}
GatewayPorts {{ 'yes' if security.ssh.gateway_ports | default(false) else 'no' }}
PermitTunnel {{ 'yes' if security.ssh.permit_tunnel | default(false) else 'no' }}
X11Forwarding no

# Logging
SyslogFacility AUTH
LogLevel INFO

# Subsystems
Subsystem sftp /usr/lib/openssh/sftp-server
