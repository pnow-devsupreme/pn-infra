---
- name: Deploy MicroK8s on all nodes
  hosts: all
  become: yes
  roles:
    - ../roles/microk8s

- name: Configure HA for MicroK8s
  hosts: masters
  become: yes
  tasks:
    - include_role:
        name: ../roles/microk8s
        tasks_from: ha
      when: ha_enabled | bool

- name: Join worker nodes to the cluster
  hosts: all
  become: yes
  tasks:
    - include_role:
        name: ../roles/microk8s
        tasks_from: workers
      when: groups['workers'] | length > 0
# - name: Configure MicroK8s addons
#   hosts: masters
#   become: yes
#   tasks:
#     - include_role:
#         name: ../roles/microk8s
#         tasks_from: addons
